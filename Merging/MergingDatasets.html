<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Merging Datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MergingDatasets_files/libs/clipboard/clipboard.min.js"></script>
<script src="MergingDatasets_files/libs/quarto-html/quarto.js"></script>
<script src="MergingDatasets_files/libs/quarto-html/popper.min.js"></script>
<script src="MergingDatasets_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MergingDatasets_files/libs/quarto-html/anchor.min.js"></script>
<link href="MergingDatasets_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MergingDatasets_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MergingDatasets_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MergingDatasets_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MergingDatasets_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Merging Datasets</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="joining-data-in-assignment-3" class="level1">
<h1>Joining Data in Assignment 3</h1>
<p>The three questions in Assignment 3 require you to merge different datasets. I knew this would be a bit of a jump for you all, but I’m experimenting with how big to make these jumps as you grow in ability and confidence.</p>
<p>In programming, there is often an elegant but hard to understand why to solve a problem as well as a kind of ugly, simpler and easier to understand way to solve a problem. If you aren’t sure how to solve a problem, then the less elegant, step-by-step way is often better and you will feel more confident that you are doing things correctly.</p>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>Joining datesets is a very powerful tool and often the way that we learn something new. However, the datasets we are using are sometimes complex and are structured in different ways. You have to spend some time exploring the datasets to understand how they are structured and how they can be used.</p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>First, we’ll load our three datasets.</p>
<p><strong>ESNames</strong> is a dataset that I created that has information on the countries in the EU and their membership status.</p>
<p>In this dataset, each row represents a country or group of countries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ESNames <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/hulseyjw/POSC644/refs/heads/main/Week3/ESNames.csv'</span>, <span class="at">col_types =</span> <span class="st">"ffffnf"</span>) <span class="co"># You may need to put a full path to the file on your computer. The strange code at the end is to specify the column types. (factor, factor, factor, factor, numeric, factor)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ESNames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  CODE      countryname    Membership    EA20  AccYr ColdWar
  &lt;fct&gt;     &lt;fct&gt;          &lt;fct&gt;         &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;  
1 EU27_2020 European Union Group         No       NA &lt;NA&gt;   
2 BE        Belgium        EUMember_2020 Yes    1957 NATO   
3 BG        Bulgaria       EUMember_2020 No     2007 WP     
4 CZ        Czechia        EUMember_2020 No     2004 WP     
5 DK        Denmark        EUMember_2020 No     1973 NATO   
6 DE        Germany        EUMember_2020 Yes    1957 NATO   </code></pre>
</div>
</div>
<p>This dataset has a few variables that we can use to join with the Eurostat data.</p>
<p><strong>CODE</strong> is the Eurostat code for the country or group of countries</p>
<p><strong>countryname</strong> is a more readable name for the country or group of countries</p>
<p><strong>Membership</strong> is the type of membership the country has relative to the EU</p>
<p><strong>EA20</strong> is a binary variable indicating whether the country is in the Euro Area</p>
<p><strong>AccYr</strong> is the year the country joined the EU (if it is a member)</p>
<p><strong>ColdWar</strong> identifies whether the country was part of NATO, the Warsaw Pact, Neutral, or part of Yugoslavia during the Cold War</p>
<p>We’re also loading two datasets from Eurostat. <strong>GDP</strong> and <strong>SB</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>GDP <span class="ot">&lt;-</span> <span class="fu">get_eurostat_data</span>(<span class="st">'tipsna40'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>SB <span class="ot">&lt;-</span> <span class="fu">get_eurostat_data</span>(<span class="st">'tps00107'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, na_item, geo&gt;
            unit na_item    geo   time values
          &lt;fctr&gt;  &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
1: CLV15_EUR_HAB    B1GQ     AT   1995  30460
2: CLV15_EUR_HAB    B1GQ     AT   1996  31130
3: CLV15_EUR_HAB    B1GQ     AT   1997  31740
4: CLV15_EUR_HAB    B1GQ     AT   1998  32850
5: CLV15_EUR_HAB    B1GQ     AT   1999  33950
6: CLV15_EUR_HAB    B1GQ     AT   2000  35010</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SB) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
      unit spdeps    geo   time values
    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
1: PPS_HAB   DISA     AL   2018 152.49
2: PPS_HAB   DISA     AL   2019 152.58
3: PPS_HAB   DISA     AL   2020 164.54
4: PPS_HAB   DISA     AL   2021 158.91
5: PPS_HAB   DISA     AT   2010 657.55
6: PPS_HAB   DISA     AT   2011 678.97</code></pre>
</div>
</div>
<p>Joining simple datasets isn’t too hard. You just need to find a common variable that you can use to join the datasets. Since ESNames has one row for each country, we can use the country code to join the datasets.</p>
<p>So, you didn’t have too much trouble with the first question in Assignment 3, because you just needed to join the GDP dataset with the ESNames dataset. Since ESNames just has one row for each country, it is not complicated to use left_join to merge the datasets.</p>
<p>GDP is a somewhat more complex dataset, because it has multiple rows for each country, representing the different years that GDP Per Capita is measured. So, each unique observation of value (the variable that has GDP Per Capita in it) is defined by country (geo) and year (time). We already have practiced filtering data, which allows us to see how this works.</p>
<p>If we use filter to show only the rows for Spain, we can see that there are multiple rows for Spain, each representing a different year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(geo <span class="sc">==</span> <span class="st">"ES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, na_item, geo&gt;
             unit na_item    geo   time values
           &lt;fctr&gt;  &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
 1: CLV15_EUR_HAB    B1GQ     ES   1995  18220
 2: CLV15_EUR_HAB    B1GQ     ES   1996  18620
 3: CLV15_EUR_HAB    B1GQ     ES   1997  19210
 4: CLV15_EUR_HAB    B1GQ     ES   1998  19960
 5: CLV15_EUR_HAB    B1GQ     ES   1999  20750
 6: CLV15_EUR_HAB    B1GQ     ES   2000  21730
 7: CLV15_EUR_HAB    B1GQ     ES   2001  22470
 8: CLV15_EUR_HAB    B1GQ     ES   2002  22720
 9: CLV15_EUR_HAB    B1GQ     ES   2003  22960
10: CLV15_EUR_HAB    B1GQ     ES   2004  23310
11: CLV15_EUR_HAB    B1GQ     ES   2005  23690
12: CLV15_EUR_HAB    B1GQ     ES   2006  24260
13: CLV15_EUR_HAB    B1GQ     ES   2007  24640
14: CLV15_EUR_HAB    B1GQ     ES   2008  24420
15: CLV15_EUR_HAB    B1GQ     ES   2009  23310
16: CLV15_EUR_HAB    B1GQ     ES   2010  23230
17: CLV15_EUR_HAB    B1GQ     ES   2011  23000
18: CLV15_EUR_HAB    B1GQ     ES   2012  22330
19: CLV15_EUR_HAB    B1GQ     ES   2013  22090
20: CLV15_EUR_HAB    B1GQ     ES   2014  22500
21: CLV15_EUR_HAB    B1GQ     ES   2015  23440
22: CLV15_EUR_HAB    B1GQ     ES   2016  24100
23: CLV15_EUR_HAB    B1GQ     ES   2017  24750
24: CLV15_EUR_HAB    B1GQ     ES   2018  25230
25: CLV15_EUR_HAB    B1GQ     ES   2019  25520
26: CLV15_EUR_HAB    B1GQ     ES   2020  22610
27: CLV15_EUR_HAB    B1GQ     ES   2021  24120
28: CLV15_EUR_HAB    B1GQ     ES   2022  25380
29: CLV15_EUR_HAB    B1GQ     ES   2023  25730
             unit na_item    geo   time values</code></pre>
</div>
</div>
<p>If we filter the data to show only the rows for 2019, we can see that there is only one row for each country.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, na_item, geo&gt;
             unit na_item       geo   time values
           &lt;fctr&gt;  &lt;fctr&gt;    &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
 1: CLV15_EUR_HAB    B1GQ        AT   2019  42030
 2: CLV15_EUR_HAB    B1GQ        BE   2019  38840
 3: CLV15_EUR_HAB    B1GQ        BG   2019   7430
 4: CLV15_EUR_HAB    B1GQ        CY   2019  25560
 5: CLV15_EUR_HAB    B1GQ        CZ   2019  18570
 6: CLV15_EUR_HAB    B1GQ        DE   2019  39840
 7: CLV15_EUR_HAB    B1GQ        DK   2019  51500
 8: CLV15_EUR_HAB    B1GQ      EA20   2019  33240
 9: CLV15_EUR_HAB    B1GQ        EE   2019  18580
10: CLV15_EUR_HAB    B1GQ        EL   2019  17140
11: CLV15_EUR_HAB    B1GQ        ES   2019  25520
12: CLV15_EUR_HAB    B1GQ EU27_2020   2019  29930
13: CLV15_EUR_HAB    B1GQ        FI   2019  41370
14: CLV15_EUR_HAB    B1GQ        FR   2019  34880
15: CLV15_EUR_HAB    B1GQ        HR   2019  12770
16: CLV15_EUR_HAB    B1GQ        HU   2019  13590
17: CLV15_EUR_HAB    B1GQ        IE   2019  69040
18: CLV15_EUR_HAB    B1GQ        IT   2019  29000
19: CLV15_EUR_HAB    B1GQ        LT   2019  15550
20: CLV15_EUR_HAB    B1GQ        LU   2019  96520
21: CLV15_EUR_HAB    B1GQ        LV   2019  14210
22: CLV15_EUR_HAB    B1GQ        MT   2019  26570
23: CLV15_EUR_HAB    B1GQ        NL   2019  44390
24: CLV15_EUR_HAB    B1GQ        PL   2019  13410
25: CLV15_EUR_HAB    B1GQ        PT   2019  19480
26: CLV15_EUR_HAB    B1GQ        RO   2019  10130
27: CLV15_EUR_HAB    B1GQ        SE   2019  47940
28: CLV15_EUR_HAB    B1GQ        SI   2019  21570
29: CLV15_EUR_HAB    B1GQ        SK   2019  16440
             unit na_item       geo   time values</code></pre>
</div>
</div>
<p>If we filter by both Spain and 2019, we can see that there is only one row for Spain in 2019. So, the <strong>key</strong> for this GDP dataset is a combination of geo and time. In other words, there is one row for each country and year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="st">"2019"</span>, geo<span class="sc">==</span><span class="st">"ES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, na_item, geo&gt;
            unit na_item    geo   time values
          &lt;fctr&gt;  &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
1: CLV15_EUR_HAB    B1GQ     ES   2019  25520</code></pre>
</div>
</div>
<p>GDP has a key of geo and time, ESNames has a key of CODE, and the contents of geo from the GDP datselt and CODE from the ESNames dataset match (ie. they use the came country codes and are formatted in the same way). So, we can use left_join to merge the datasets. Unlike in my example for the homework, I’m putting the resulting dataset in a new dataset called GDP_ESN. This avoids the problem many of you were having of repeatedly joining things to one dataset and getting values.x and values.y.</p>
<p>We’re just merging on one variable from each dataset, so for all of the rows for each country in GDP (regardless of year), we’re adding the information from ESNames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>GDP_ESN <span class="ot">&lt;-</span> GDP <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ESNames, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"geo"</span> <span class="ot">=</span> <span class="st">"CODE"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(GDP_ESN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, na_item, geo&gt;
            unit na_item    geo   time values countryname    Membership   EA20
          &lt;fctr&gt;  &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;      &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt;
1: CLV15_EUR_HAB    B1GQ     AT   1995  30460     Austria EUMember_2020    Yes
2: CLV15_EUR_HAB    B1GQ     AT   1996  31130     Austria EUMember_2020    Yes
3: CLV15_EUR_HAB    B1GQ     AT   1997  31740     Austria EUMember_2020    Yes
4: CLV15_EUR_HAB    B1GQ     AT   1998  32850     Austria EUMember_2020    Yes
5: CLV15_EUR_HAB    B1GQ     AT   1999  33950     Austria EUMember_2020    Yes
6: CLV15_EUR_HAB    B1GQ     AT   2000  35010     Austria EUMember_2020    Yes
   AccYr ColdWar
   &lt;num&gt;  &lt;fctr&gt;
1:  1995 Neutral
2:  1995 Neutral
3:  1995 Neutral
4:  1995 Neutral
5:  1995 Neutral
6:  1995 Neutral</code></pre>
</div>
</div>
<p>You can use this new dataset GDP_ESN to answer the first question in Assignment 3.</p>
</section>
<section id="working-with-the-sb-dataset" class="level2">
<h2 class="anchored" data-anchor-id="working-with-the-sb-dataset">Working with the SB dataset</h2>
<p>For SB, the values represent social benefits per capita for each country, year and type of benefit (OLD, SICK, FAM, UNEMP, DISAB, HOUS, and OTH).So SB has three keys: geo, time and spdeps.</p>
<p>If we just filter by Spain, then it shows us all of the rows for Spain, regardless of year or type of benefit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>SB <span class="sc">%&gt;%</span> <span class="fu">filter</span>(geo<span class="sc">==</span><span class="st">"ES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
        unit   spdeps    geo   time values
      &lt;fctr&gt;   &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;
  1: PPS_HAB     DISA     ES   2010 400.89
  2: PPS_HAB     DISA     ES   2011 404.03
  3: PPS_HAB     DISA     ES   2012 405.49
  4: PPS_HAB     DISA     ES   2013 417.64
  5: PPS_HAB     DISA     ES   2014 424.77
 ---                                      
104: PPS_HAB UNEMPLOY     ES   2017 451.51
105: PPS_HAB UNEMPLOY     ES   2018 442.76
106: PPS_HAB UNEMPLOY     ES   2019 464.04
107: PPS_HAB UNEMPLOY     ES   2020 847.35
108: PPS_HAB UNEMPLOY     ES   2021 664.85</code></pre>
</div>
</div>
<p>If we filter by Spain and 2019, then it shows us all of the rows for Spain in 2019, regardless of type of benefit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>SB <span class="sc">%&gt;%</span> <span class="fu">filter</span>(geo<span class="sc">==</span><span class="st">"ES"</span>, time<span class="sc">==</span><span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
      unit           spdeps    geo   time  values
    &lt;fctr&gt;           &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;   &lt;num&gt;
1: PPS_HAB             DISA     ES   2019  449.19
2: PPS_HAB            EXCLU     ES   2019   65.60
3: PPS_HAB              FAM     ES   2019  367.10
4: PPS_HAB            HOUSE     ES   2019   30.71
5: PPS_HAB              OLD     ES   2019 2676.56
6: PPS_HAB             SICK     ES   2019 1812.62
7: PPS_HAB SPBENEFNOREROUTE     ES   2019 6498.85
8: PPS_HAB           SURVIV     ES   2019  633.03
9: PPS_HAB         UNEMPLOY     ES   2019  464.04</code></pre>
</div>
</div>
<p>If we filter by 2019, and OLD, then it shows us the the spending on Old Age benefits for all countries in 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>SB <span class="sc">%&gt;%</span> <span class="fu">filter</span>(spdeps <span class="sc">==</span><span class="st">"OLD"</span>, time<span class="sc">==</span><span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
       unit spdeps       geo   time  values
     &lt;fctr&gt; &lt;fctr&gt;    &lt;fctr&gt; &lt;fctr&gt;   &lt;num&gt;
 1: PPS_HAB    OLD        AL   2019  593.93
 2: PPS_HAB    OLD        AT   2019 4843.82
 3: PPS_HAB    OLD        BE   2019 3925.02
 4: PPS_HAB    OLD        BG   2019 1202.78
 5: PPS_HAB    OLD        CH   2019 4743.21
 6: PPS_HAB    OLD        CY   2019 2388.83
 7: PPS_HAB    OLD        CZ   2019 2466.49
 8: PPS_HAB    OLD        DE   2019 4056.28
 9: PPS_HAB    OLD        DK   2019 4498.70
10: PPS_HAB    OLD      EA19   2019 3716.11
11: PPS_HAB    OLD      EA20   2019 3693.47
12: PPS_HAB    OLD        EE   2019 1686.08
13: PPS_HAB    OLD        EL   2019 2719.89
14: PPS_HAB    OLD        ES   2019 2676.56
15: PPS_HAB    OLD EU27_2020   2019 3463.90
16: PPS_HAB    OLD        FI   2019 4351.46
17: PPS_HAB    OLD        FR   2019 4159.16
18: PPS_HAB    OLD        HR   2019 1469.27
19: PPS_HAB    OLD        HU   2019 1703.69
20: PPS_HAB    OLD        IE   2019 2185.89
21: PPS_HAB    OLD        IS   2019 2599.98
22: PPS_HAB    OLD        IT   2019 4071.84
23: PPS_HAB    OLD        LT   2019 1807.18
24: PPS_HAB    OLD        LU   2019 4866.81
25: PPS_HAB    OLD        LV   2019 1515.92
26: PPS_HAB    OLD        ME   2019  952.38
27: PPS_HAB    OLD        MT   2019 2014.55
28: PPS_HAB    OLD        NL   2019 3978.80
29: PPS_HAB    OLD        NO   2019 4515.47
30: PPS_HAB    OLD        PL   2019 2335.59
31: PPS_HAB    OLD        PT   2019 2735.91
32: PPS_HAB    OLD        RO   2019 1639.14
33: PPS_HAB    OLD        RS   2019 1141.89
34: PPS_HAB    OLD        SE   2019 4256.94
35: PPS_HAB    OLD        SI   2019 2402.54
36: PPS_HAB    OLD        SK   2019 1548.10
37: PPS_HAB    OLD        TR   2019 1219.05
       unit spdeps       geo   time  values</code></pre>
</div>
</div>
<p>In order to isolate one row, we have to filter by all three keys.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>SB <span class="sc">%&gt;%</span> <span class="fu">filter</span>(geo<span class="sc">==</span><span class="st">"ES"</span>, time<span class="sc">==</span><span class="st">"2019"</span>, spdeps<span class="sc">==</span><span class="st">"OLD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
      unit spdeps    geo   time  values
    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;   &lt;num&gt;
1: PPS_HAB    OLD     ES   2019 2676.56</code></pre>
</div>
</div>
<p>To answer question 2 in Assignment 3, you will need to merge the SB dataset with the ESNames dataset. Since there is a unique row for each country in ESNames, you can use left_join to merge the datasets, and all of the rows for each country in SB will be merged with the information from ESNames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>SB_ESN <span class="ot">&lt;-</span> SB <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ESNames, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"geo"</span> <span class="ot">=</span> <span class="st">"CODE"</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SB_ESN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
      unit spdeps    geo   time values countryname    Membership   EA20 AccYr
    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;num&gt;      &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt; &lt;num&gt;
1: PPS_HAB   DISA     AL   2018 152.49        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
2: PPS_HAB   DISA     AL   2019 152.58        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
3: PPS_HAB   DISA     AL   2020 164.54        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
4: PPS_HAB   DISA     AL   2021 158.91        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
5: PPS_HAB   DISA     AT   2010 657.55     Austria EUMember_2020    Yes  1995
6: PPS_HAB   DISA     AT   2011 678.97     Austria EUMember_2020    Yes  1995
   ColdWar
    &lt;fctr&gt;
1:    &lt;NA&gt;
2:    &lt;NA&gt;
3:    &lt;NA&gt;
4:    &lt;NA&gt;
5: Neutral
6: Neutral</code></pre>
</div>
</div>
<p>Since questions 1 and 2 just involve adding information from ESNames to the GDP and SB datasets, they are relatively simple joins Where things get more complicated is in merging the GDP and SB datasets, because GDP has two keys (geo and time) and SB has three keys (geo, time, and spdeps). Some of you already had difficulty with question two because you were trying to merge GDP with the ESNames variables to SB. This isn’t wrong, but it does make question 2 harder than it needs to be.</p>
<p>Question 3 asks whether wealthier countries in the EU spend more on social benefits for families than poorer countries. To answer this question, you will need to merge the GDP and SB datasets. Since GDP has two keys (geo and time) and SB has three keys (geo, time, and spdeps), the way we’ve been joining above won’t work. It worked when ESNames was the dataset we were adding to GDP or SB, because it had only one key, so we only had to join on one shared variable by=c(“geo”=“CODE”).</p>
<p>There are two ways to deal with this problem. We can call it the “inelegant but works” way and the “elegant but hard to understand” way. Let’s do the “inelegant but works” way first.</p>
<p>## Inelegant but Works</p>
<p>This way of dealing with the problem is possible because to answer question 3, we don’t need all of the information in the two datasets, so we can make them simpler by filtering them and then merge the filtered, simpler datasets. First, we can filter the SB_ESN dataset to only include the information that we need. I’m using SB_ESN because it has the ColdWar vairable in it, which we need to answer question 3.</p>
<p>To answer our question, we need to know the family benefits for each country in 2021, the most recent year they have data. So, we can filter the SB_ESN dataset to only include the rows for 2021 and FAM. Since we are filtering two of the keys, the resulting dataset will have only one key (geo).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>SB_FAM <span class="ot">&lt;-</span> SB_ESN <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="st">"2021"</span>, spdeps<span class="sc">==</span><span class="st">"FAM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the same way, we onlly need GDP for 2021, so we can filter the GDP database to only include the rows for 2021. (I wouldn’t use GDP_ESN because it duplicates the ESNames variables we already have from SB_ESN.) I’m also using select to choose only the variables that we need and using rename to rename the values variable to GDP, since we already have a values in the SB_FAM dataset, but that values has different values and a different meaning (it’s the family spending)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>GDP_2021 <span class="ot">&lt;-</span> GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="st">"2021"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo, values) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GDP =</span> values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have two datasets that have only one key (geo) and we can merge them using left_join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>GDP_SB_FAM <span class="ot">&lt;-</span> GDP_2021 <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(SB_FAM, <span class="at">by =</span> <span class="st">"geo"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(GDP_SB_FAM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit&gt;
      geo   GDP    unit spdeps   time  values countryname    Membership   EA20
   &lt;fctr&gt; &lt;num&gt;  &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;   &lt;num&gt;      &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt;
1:     AT 40560 PPS_HAB    FAM   2021 1057.19     Austria EUMember_2020    Yes
2:     BE 39000 PPS_HAB    FAM   2021  802.94     Belgium EUMember_2020    Yes
3:     BG  7790 PPS_HAB    FAM   2021  310.20    Bulgaria EUMember_2020     No
4:     CY 26570 PPS_HAB    FAM   2021  301.69      Cyprus EUMember_2020    Yes
5:     CZ 18380 PPS_HAB    FAM   2021  558.14     Czechia EUMember_2020     No
6:     DE 39570 PPS_HAB    FAM   2021 1450.56     Germany EUMember_2020    Yes
   AccYr ColdWar
   &lt;num&gt;  &lt;fctr&gt;
1:  1995 Neutral
2:  1957    NATO
3:  2007      WP
4:  2004    NATO
5:  2004      WP
6:  1957    NATO</code></pre>
</div>
</div>
<p>Your new dataset GDP_SB_FAM has the information you need to answer question 3.</p>
</section>
<section id="elegant-but-harder-to-understand-method" class="level2">
<h2 class="anchored" data-anchor-id="elegant-but-harder-to-understand-method">Elegant but Harder to Understand Method</h2>
<p>It is possible to merge the GDP and SB datasets without filtering them first. This is a more elegant solution, but it is harder to understand and verify that you are doing what you think you are doing. The key to doing this is to use the by argument in left_join to specify the variables that you are joining on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>SB_GDP <span class="ot">&lt;-</span> SB_ESN <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(GDP, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"geo"</span>, <span class="st">"time"</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SB_GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    unit.x spdeps    geo   time values.x countryname    Membership   EA20 AccYr
    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;      &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt; &lt;num&gt;
1: PPS_HAB   DISA     AL   2018   152.49        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
2: PPS_HAB   DISA     AL   2019   152.58        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
3: PPS_HAB   DISA     AL   2020   164.54        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
4: PPS_HAB   DISA     AL   2021   158.91        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA
5: PPS_HAB   DISA     AT   2010   657.55     Austria EUMember_2020    Yes  1995
6: PPS_HAB   DISA     AT   2011   678.97     Austria EUMember_2020    Yes  1995
   ColdWar        unit.y na_item values.y
    &lt;fctr&gt;        &lt;fctr&gt;  &lt;fctr&gt;    &lt;num&gt;
1:    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
2:    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
3:    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
4:    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
5: Neutral CLV15_EUR_HAB    B1GQ    39070
6: Neutral CLV15_EUR_HAB    B1GQ    40080</code></pre>
</div>
</div>
<p>In order to look at this complex dataset and see if it is what you think it is, you can filter it to only include the rows for 2021 and FAM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>SB_GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="st">"2021"</span>, spdeps<span class="sc">==</span><span class="st">"FAM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
     unit.x spdeps       geo   time values.x    countryname    Membership
     &lt;fctr&gt; &lt;fctr&gt;    &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;         &lt;fctr&gt;        &lt;fctr&gt;
 1: PPS_HAB    FAM        AL   2021    83.56           &lt;NA&gt;          &lt;NA&gt;
 2: PPS_HAB    FAM        AT   2021  1057.19        Austria EUMember_2020
 3: PPS_HAB    FAM        BE   2021   802.94        Belgium EUMember_2020
 4: PPS_HAB    FAM        BG   2021   310.20       Bulgaria EUMember_2020
 5: PPS_HAB    FAM        CH   2021   707.61    Switzerland          EFTA
 6: PPS_HAB    FAM        CY   2021   301.69         Cyprus EUMember_2020
 7: PPS_HAB    FAM        CZ   2021   558.14        Czechia EUMember_2020
 8: PPS_HAB    FAM        DE   2021  1450.56        Germany EUMember_2020
 9: PPS_HAB    FAM        DK   2021  1291.64        Denmark EUMember_2020
10: PPS_HAB    FAM      EA19   2021   789.17           &lt;NA&gt;          &lt;NA&gt;
11: PPS_HAB    FAM      EA20   2021   785.64      Euro Area         Group
12: PPS_HAB    FAM        EE   2021   609.22        Estonia EUMember_2020
13: PPS_HAB    FAM        EL   2021   289.02         Greece EUMember_2020
14: PPS_HAB    FAM        ES   2021   403.37          Spain EUMember_2020
15: PPS_HAB    FAM EU27_2020   2021   776.54 European Union         Group
16: PPS_HAB    FAM        FI   2021  1056.55        Finland EUMember_2020
17: PPS_HAB    FAM        FR   2021   765.45         France EUMember_2020
18: PPS_HAB    FAM        HR   2021   441.32        Croatia EUMember_2020
19: PPS_HAB    FAM        HU   2021   464.89        Hungary EUMember_2020
20: PPS_HAB    FAM        IE   2021   657.07        Ireland EUMember_2020
21: PPS_HAB    FAM        IS   2021  1025.27        Iceland          EFTA
22: PPS_HAB    FAM        IT   2021   378.83          Italy EUMember_2020
23: PPS_HAB    FAM        LT   2021   598.47      Lithuania EUMember_2020
24: PPS_HAB    FAM        LU   2021  2357.76     Luxembourg EUMember_2020
25: PPS_HAB    FAM        LV   2021   490.96         Latvia EUMember_2020
26: PPS_HAB    FAM        ME   2021   111.96     Montenegro  EU_Candidate
27: PPS_HAB    FAM        MT   2021   306.21          Malta EUMember_2020
28: PPS_HAB    FAM        NL   2021   526.75    Netherlands EUMember_2020
29: PPS_HAB    FAM        NO   2021  1403.65         Norway          EFTA
30: PPS_HAB    FAM        PL   2021   909.00         Poland EUMember_2020
31: PPS_HAB    FAM        PT   2021   310.46       Portugal EUMember_2020
32: PPS_HAB    FAM        RO   2021   496.92        Romania EUMember_2020
33: PPS_HAB    FAM        RS   2021   174.34         Serbia  EU_Candidate
34: PPS_HAB    FAM        SE   2021  1034.83         Sweden EUMember_2020
35: PPS_HAB    FAM        SI   2021   523.62       Slovenia EUMember_2020
36: PPS_HAB    FAM        SK   2021   436.45       Slovakia EUMember_2020
37: PPS_HAB    FAM        TR   2021   104.26         Turkey  EU_Candidate
     unit.x spdeps       geo   time values.x    countryname    Membership
      EA20 AccYr ColdWar        unit.y na_item values.y
    &lt;fctr&gt; &lt;num&gt;  &lt;fctr&gt;        &lt;fctr&gt;  &lt;fctr&gt;    &lt;num&gt;
 1:   &lt;NA&gt;    NA    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
 2:    Yes  1995 Neutral CLV15_EUR_HAB    B1GQ    40560
 3:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    39000
 4:     No  2007      WP CLV15_EUR_HAB    B1GQ     7790
 5:     No    NA Neutral          &lt;NA&gt;    &lt;NA&gt;       NA
 6:    Yes  2004    NATO CLV15_EUR_HAB    B1GQ    26570
 7:     No  2004      WP CLV15_EUR_HAB    B1GQ    18380
 8:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    39570
 9:     No  1973    NATO CLV15_EUR_HAB    B1GQ    53970
10:   &lt;NA&gt;    NA    &lt;NA&gt;          &lt;NA&gt;    &lt;NA&gt;       NA
11:     No    NA    &lt;NA&gt; CLV15_EUR_HAB    B1GQ    33100
12:    Yes  2004      WP CLV15_EUR_HAB    B1GQ    19250
13:    Yes  1981    NATO CLV15_EUR_HAB    B1GQ    16980
14:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    24120
15:     No    NA    &lt;NA&gt; CLV15_EUR_HAB    B1GQ    30000
16:    Yes  1995 Neutral CLV15_EUR_HAB    B1GQ    41290
17:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    34260
18:    Yes  2013    Yugo CLV15_EUR_HAB    B1GQ    13570
19:     No  2004      WP CLV15_EUR_HAB    B1GQ    13990
20:    Yes  1973 Neutral CLV15_EUR_HAB    B1GQ    83910
21:     No    NA    NATO          &lt;NA&gt;    &lt;NA&gt;       NA
22:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    29080
23:    Yes  2004      WP CLV15_EUR_HAB    B1GQ    16440
24:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    99360
25:    Yes  2004      WP CLV15_EUR_HAB    B1GQ    14870
26:     No    NA    Yugo          &lt;NA&gt;    &lt;NA&gt;       NA
27:    Yes  2004 Neutral CLV15_EUR_HAB    B1GQ    28340
28:    Yes  1957    NATO CLV15_EUR_HAB    B1GQ    44870
29:     No    NA    NATO          &lt;NA&gt;    &lt;NA&gt;       NA
30:     No  2004      WP CLV15_EUR_HAB    B1GQ    14140
31:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    18880
32:     No  2007      WP CLV15_EUR_HAB    B1GQ    10460
33:     No    NA    Yugo          &lt;NA&gt;    &lt;NA&gt;       NA
34:     No  1995 Neutral CLV15_EUR_HAB    B1GQ    49110
35:    Yes  2004    Yugo CLV15_EUR_HAB    B1GQ    22230
36:    Yes  2004      WP CLV15_EUR_HAB    B1GQ    16690
37:     No    NA    NATO          &lt;NA&gt;    &lt;NA&gt;       NA
      EA20 AccYr ColdWar        unit.y na_item values.y</code></pre>
</div>
</div>
<p>We can play around with filtering in different ways and looking at the dataset to verify that it has joined the dataset in the way that we expect. The new dataset has the same keys as the original SB dataset, so we can use the same methods to filter it and look at it. Since GDP just had two keys, all of the rows that have the same value for geo and time will have the same GDP information for that country and year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>SB_GDP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(geo<span class="sc">==</span><span class="st">"ES"</span>, time<span class="sc">==</span><span class="st">"2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;unit, spdeps, geo&gt;
    unit.x           spdeps    geo   time values.x countryname    Membership
    &lt;fctr&gt;           &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;      &lt;fctr&gt;        &lt;fctr&gt;
1: PPS_HAB             DISA     ES   2019   449.19       Spain EUMember_2020
2: PPS_HAB            EXCLU     ES   2019    65.60       Spain EUMember_2020
3: PPS_HAB              FAM     ES   2019   367.10       Spain EUMember_2020
4: PPS_HAB            HOUSE     ES   2019    30.71       Spain EUMember_2020
5: PPS_HAB              OLD     ES   2019  2676.56       Spain EUMember_2020
6: PPS_HAB             SICK     ES   2019  1812.62       Spain EUMember_2020
7: PPS_HAB SPBENEFNOREROUTE     ES   2019  6498.85       Spain EUMember_2020
8: PPS_HAB           SURVIV     ES   2019   633.03       Spain EUMember_2020
9: PPS_HAB         UNEMPLOY     ES   2019   464.04       Spain EUMember_2020
     EA20 AccYr ColdWar        unit.y na_item values.y
   &lt;fctr&gt; &lt;num&gt;  &lt;fctr&gt;        &lt;fctr&gt;  &lt;fctr&gt;    &lt;num&gt;
1:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
2:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
3:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
4:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
5:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
6:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
7:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
8:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520
9:    Yes  1986    NATO CLV15_EUR_HAB    B1GQ    25520</code></pre>
</div>
</div>
<p>One thing that we can see is that we have a number of variables that we don’t need and we have some variables with suffixes .x and .y. This is because the variables in the two datasets had the same name, so R added the suffixes to distinguish them. We can use select to choose only the variables that we need and rename to rename the variables that have suffixes. Most important, the values variable from the GDP dataset values.y must be renamed to GDP, because we already have a values variable in the SB dataset (values.x) and it has a different meaning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>SB_GDP <span class="ot">&lt;-</span> SB_GDP <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo, time, values.y, spdeps, countryname, Membership, EA20, AccYr, ColdWar) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GDP =</span> values.y)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SB_GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      geo   time   GDP spdeps countryname    Membership   EA20 AccYr ColdWar
   &lt;fctr&gt; &lt;fctr&gt; &lt;num&gt; &lt;fctr&gt;      &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt; &lt;num&gt;  &lt;fctr&gt;
1:     AL   2018    NA   DISA        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA    &lt;NA&gt;
2:     AL   2019    NA   DISA        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA    &lt;NA&gt;
3:     AL   2020    NA   DISA        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA    &lt;NA&gt;
4:     AL   2021    NA   DISA        &lt;NA&gt;          &lt;NA&gt;   &lt;NA&gt;    NA    &lt;NA&gt;
5:     AT   2010 39070   DISA     Austria EUMember_2020    Yes  1995 Neutral
6:     AT   2011 40080   DISA     Austria EUMember_2020    Yes  1995 Neutral</code></pre>
</div>
</div>
<p>Now we can use this dataset to answer question 3. We’ll still have to filter it when we use it in order to make our plots and answer the question.</p>
</section>
<section id="inelegant-vs.-elegant" class="level2">
<h2 class="anchored" data-anchor-id="inelegant-vs.-elegant">Inelegant vs.&nbsp;Elegant</h2>
<p>Both of these methods work to answer the question. So, you should use the one that makes sense to you. For me, the advante of the inelegant method of filtering and then merging is that it is easier for me to verify that I am doing what I think I am doing. I can look at the filtered datasets and see that they are what I expect.</p>
<p>The advantage of the elegant method of merging and then filtering is that it is more efficient and doesn’t require you to create new datasets. I can just use the complex, new dataset and filter it for what I need when I need it.</p>
<p>If I were going to go on and make plots for all of the different kinds of social benefits or different combinations of years over time, then the elegant way would be a lot faster. The inelegant way would still work, but I’d have to go back and step by step make the new datasets for each new plot.</p>
</section>
<section id="homework" class="level2">
<h2 class="anchored" data-anchor-id="homework">Homework</h2>
<p>For each question, create a figure that explores the question and write a brief explanation of what you see. Clearly label your plots. Submit the .qmd file and the .html file to Canvas.</p>
<ol type="1">
<li>Do countries who joined the EU earlier tend to be wealthier or poorer than those who joined later? Create a plot that shows the relationship.</li>
</ol>
<ol start="2" type="1">
<li><p>Do former communist countries spend more or less on social benefits for the old and sick than other countries? Create a plot that shows the relationship.(spdeps in SB has OLD and SICK)</p></li>
<li><p>Do wealthier countries in the EU spend more on social benefits for families (FAM) than poorer countries? Create a plot that shows the relationship.</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>